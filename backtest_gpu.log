nohup: ignoring input
=== AMD GPU Environment Setup ===
HSA_OVERRIDE_GFX_VERSION: 10.3.0
PYTORCH_HIP_ALLOC_CONF: expandable_segments:True
==================================

/home/kishan/Documents/DGRCL_Strategy/train.py:1010: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
/home/kishan/Documents/DGRCL_Strategy/data_loader.py:371: UserWarning: std(): degrees of freedom is <= 0. Correction should be strictly less than the reduction factor (input numel divided by output numel). (Triggered internally at ../aten/src/ATen/native/ReduceOps.cpp:1823.)
  s = window_data.std(dim=1, unbiased=True).clamp(min=1e-8)
Feature ablation: 'baseline' → 8 features: ['Close', 'High', 'Low', 'Log_Vol', 'RSI_14', 'MACD', 'Volatility_5', 'Returns']
Using device: cuda
Magnitude loss weight (λ): 0.05
Mixed Precision Training (FP16): ENABLED

=== Loading Real Market Data ===
  Selecting top 150 stocks from 338 by avg absolute returns (liquidity proxy, valid days only)...
Loaded 150 stocks, 4 macro factors
Time range: 2007-01-25 00:00:00 to 2026-02-20 00:00:00 (4799 trading days)
Stock tensor: torch.Size([150, 4799, 8])
Macro tensor: torch.Size([4, 4799, 4])
Inclusion mask: torch.Size([150, 4799])
  Active stocks per timestep: min=137, mean=144, max=150
Applying macro lag of 5 days for causality...
  Aligned data shape: 4794 timesteps
  Loading sector map from: ./data/ticker_sector_map.csv

Creating 90 backtest folds:
  Window size: 60 days
  Forecast horizon: 5 days
  Snapshot step size: 1 days
  Fold 1: train [0:200] → 136 snapshots (~148 active stocks), val [200:300] → 36 snapshots
  Fold 2: train [50:250] → 136 snapshots (~147 active stocks), val [250:350] → 36 snapshots
  Fold 3: train [100:300] → 136 snapshots (~146 active stocks), val [300:400] → 36 snapshots
  Fold 4: train [150:350] → 136 snapshots (~146 active stocks), val [350:450] → 36 snapshots
  Fold 5: train [200:400] → 136 snapshots (~147 active stocks), val [400:500] → 36 snapshots
  Fold 6: train [250:450] → 136 snapshots (~147 active stocks), val [450:550] → 36 snapshots
  Fold 7: train [300:500] → 136 snapshots (~147 active stocks), val [500:600] → 36 snapshots
  Fold 8: train [350:550] → 136 snapshots (~147 active stocks), val [550:650] → 36 snapshots
  Fold 9: train [400:600] → 136 snapshots (~148 active stocks), val [600:700] → 36 snapshots
  Fold 10: train [450:650] → 136 snapshots (~149 active stocks), val [650:750] → 36 snapshots
  Fold 11: train [500:700] → 136 snapshots (~149 active stocks), val [700:800] → 36 snapshots
  Fold 12: train [550:750] → 136 snapshots (~149 active stocks), val [750:850] → 36 snapshots
  Fold 13: train [600:800] → 136 snapshots (~149 active stocks), val [800:900] → 36 snapshots
  Fold 14: train [650:850] → 136 snapshots (~149 active stocks), val [850:950] → 36 snapshots
  Fold 15: train [700:900] → 136 snapshots (~148 active stocks), val [900:1000] → 36 snapshots
  Fold 16: train [750:950] → 136 snapshots (~147 active stocks), val [950:1050] → 36 snapshots
  Fold 17: train [800:1000] → 136 snapshots (~146 active stocks), val [1000:1100] → 36 snapshots
  Fold 18: train [850:1050] → 136 snapshots (~146 active stocks), val [1050:1150] → 36 snapshots
  Fold 19: train [900:1100] → 136 snapshots (~145 active stocks), val [1100:1200] → 36 snapshots
  Fold 20: train [950:1150] → 136 snapshots (~144 active stocks), val [1150:1250] → 36 snapshots
  Fold 21: train [1000:1200] → 136 snapshots (~144 active stocks), val [1200:1300] → 36 snapshots
  Fold 22: train [1050:1250] → 136 snapshots (~144 active stocks), val [1250:1350] → 36 snapshots
  Fold 23: train [1100:1300] → 136 snapshots (~144 active stocks), val [1300:1400] → 36 snapshots
  Fold 24: train [1150:1350] → 136 snapshots (~145 active stocks), val [1350:1450] → 36 snapshots
  Fold 25: train [1200:1400] → 136 snapshots (~146 active stocks), val [1400:1500] → 36 snapshots
  Fold 26: train [1250:1450] → 136 snapshots (~147 active stocks), val [1450:1550] → 36 snapshots
  Fold 27: train [1300:1500] → 136 snapshots (~147 active stocks), val [1500:1600] → 36 snapshots
  Fold 28: train [1350:1550] → 136 snapshots (~145 active stocks), val [1550:1650] → 36 snapshots
  Fold 29: train [1400:1600] → 136 snapshots (~145 active stocks), val [1600:1700] → 36 snapshots
  Fold 30: train [1450:1650] → 136 snapshots (~146 active stocks), val [1650:1750] → 36 snapshots
  Fold 31: train [1500:1700] → 136 snapshots (~147 active stocks), val [1700:1800] → 36 snapshots
  Fold 32: train [1550:1750] → 136 snapshots (~147 active stocks), val [1750:1850] → 36 snapshots
  Fold 33: train [1600:1800] → 136 snapshots (~147 active stocks), val [1800:1900] → 36 snapshots
  Fold 34: train [1650:1850] → 136 snapshots (~146 active stocks), val [1850:1950] → 36 snapshots
  Fold 35: train [1700:1900] → 136 snapshots (~147 active stocks), val [1900:2000] → 36 snapshots
  Fold 36: train [1750:1950] → 136 snapshots (~146 active stocks), val [1950:2050] → 36 snapshots
  Fold 37: train [1800:2000] → 136 snapshots (~146 active stocks), val [2000:2100] → 36 snapshots
  Fold 38: train [1850:2050] → 136 snapshots (~147 active stocks), val [2050:2150] → 36 snapshots
  Fold 39: train [1900:2100] → 136 snapshots (~146 active stocks), val [2100:2200] → 36 snapshots
  Fold 40: train [1950:2150] → 136 snapshots (~145 active stocks), val [2150:2250] → 36 snapshots
  Fold 41: train [2000:2200] → 136 snapshots (~145 active stocks), val [2200:2300] → 36 snapshots
  Fold 42: train [2050:2250] → 136 snapshots (~146 active stocks), val [2250:2350] → 36 snapshots
  Fold 43: train [2100:2300] → 136 snapshots (~146 active stocks), val [2300:2400] → 36 snapshots
  Fold 44: train [2150:2350] → 136 snapshots (~146 active stocks), val [2350:2450] → 36 snapshots
  Fold 45: train [2200:2400] → 136 snapshots (~145 active stocks), val [2400:2500] → 36 snapshots
  Fold 46: train [2250:2450] → 136 snapshots (~145 active stocks), val [2450:2550] → 36 snapshots
  Fold 47: train [2300:2500] → 136 snapshots (~145 active stocks), val [2500:2600] → 36 snapshots
  Fold 48: train [2350:2550] → 136 snapshots (~145 active stocks), val [2550:2650] → 36 snapshots
  Fold 49: train [2400:2600] → 136 snapshots (~144 active stocks), val [2600:2700] → 36 snapshots
  Fold 50: train [2450:2650] → 136 snapshots (~144 active stocks), val [2650:2750] → 36 snapshots
  Fold 51: train [2500:2700] → 136 snapshots (~143 active stocks), val [2700:2800] → 36 snapshots
  Fold 52: train [2550:2750] → 136 snapshots (~141 active stocks), val [2750:2850] → 36 snapshots
  Fold 53: train [2600:2800] → 136 snapshots (~140 active stocks), val [2800:2900] → 36 snapshots
  Fold 54: train [2650:2850] → 136 snapshots (~140 active stocks), val [2850:2950] → 36 snapshots
  Fold 55: train [2700:2900] → 136 snapshots (~140 active stocks), val [2900:3000] → 36 snapshots
  Fold 56: train [2750:2950] → 136 snapshots (~140 active stocks), val [2950:3050] → 36 snapshots
  Fold 57: train [2800:3000] → 136 snapshots (~139 active stocks), val [3000:3100] → 36 snapshots
  Fold 58: train [2850:3050] → 136 snapshots (~139 active stocks), val [3050:3150] → 36 snapshots
  Fold 59: train [2900:3100] → 136 snapshots (~139 active stocks), val [3100:3200] → 36 snapshots
  Fold 60: train [2950:3150] → 136 snapshots (~139 active stocks), val [3150:3250] → 36 snapshots
  Fold 61: train [3000:3200] → 136 snapshots (~139 active stocks), val [3200:3300] → 36 snapshots
  Fold 62: train [3050:3250] → 136 snapshots (~140 active stocks), val [3250:3350] → 36 snapshots
  Fold 63: train [3100:3300] → 136 snapshots (~140 active stocks), val [3300:3400] → 36 snapshots
  Fold 64: train [3150:3350] → 136 snapshots (~141 active stocks), val [3350:3450] → 36 snapshots
  Fold 65: train [3200:3400] → 136 snapshots (~141 active stocks), val [3400:3500] → 36 snapshots
  Fold 66: train [3250:3450] → 136 snapshots (~142 active stocks), val [3450:3550] → 36 snapshots
  Fold 67: train [3300:3500] → 136 snapshots (~140 active stocks), val [3500:3600] → 36 snapshots
  Fold 68: train [3350:3550] → 136 snapshots (~139 active stocks), val [3550:3650] → 36 snapshots
  Fold 69: train [3400:3600] → 136 snapshots (~138 active stocks), val [3600:3700] → 36 snapshots
  Fold 70: train [3450:3650] → 136 snapshots (~138 active stocks), val [3650:3750] → 36 snapshots
  Fold 71: train [3500:3700] → 136 snapshots (~139 active stocks), val [3700:3800] → 36 snapshots
  Fold 72: train [3550:3750] → 136 snapshots (~141 active stocks), val [3750:3850] → 36 snapshots
/home/kishan/Documents/DGRCL_Strategy/train.py:1159: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = torch.cuda.amp.GradScaler()
/home/kishan/Documents/DGRCL_Strategy/venv/lib/python3.12/site-packages/torch/nn/modules/module.py:1326: UserWarning: expandable_segments not supported on this platform (Triggered internally at ../c10/hip/HIPAllocatorConfig.h:29.)
  return t.to(
/home/kishan/Documents/DGRCL_Strategy/train.py:265: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast(enabled=use_amp):
/home/kishan/Documents/DGRCL_Strategy/venv/lib/python3.12/site-packages/torch/nn/modules/linear.py:125: UserWarning: Attempting to use hipBLASLt on an unsupported architecture! Overriding blas backend to hipblas (Triggered internally at ../aten/src/ATen/Context.cpp:296.)
  return F.linear(input, self.weight, self.bias)
/home/kishan/Documents/DGRCL_Strategy/train.py:485: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast(enabled=stock_feat.is_cuda):
  Fold 73: train [3600:3800] → 136 snapshots (~143 active stocks), val [3800:3900] → 36 snapshots
  Fold 74: train [3650:3850] → 136 snapshots (~143 active stocks), val [3850:3950] → 36 snapshots
  Fold 75: train [3700:3900] → 136 snapshots (~143 active stocks), val [3900:4000] → 36 snapshots
  Fold 76: train [3750:3950] → 136 snapshots (~141 active stocks), val [3950:4050] → 36 snapshots
  Fold 77: train [3800:4000] → 136 snapshots (~139 active stocks), val [4000:4100] → 36 snapshots
  Fold 78: train [3850:4050] → 136 snapshots (~139 active stocks), val [4050:4150] → 36 snapshots
  Fold 79: train [3900:4100] → 136 snapshots (~140 active stocks), val [4100:4200] → 36 snapshots
  Fold 80: train [3950:4150] → 136 snapshots (~141 active stocks), val [4150:4250] → 36 snapshots
  Fold 81: train [4000:4200] → 136 snapshots (~143 active stocks), val [4200:4300] → 36 snapshots
  Fold 82: train [4050:4250] → 136 snapshots (~144 active stocks), val [4250:4350] → 36 snapshots
  Fold 83: train [4100:4300] → 136 snapshots (~144 active stocks), val [4300:4400] → 36 snapshots
  Fold 84: train [4150:4350] → 136 snapshots (~145 active stocks), val [4350:4450] → 36 snapshots
  Fold 85: train [4200:4400] → 136 snapshots (~145 active stocks), val [4400:4500] → 36 snapshots
  Fold 86: train [4250:4450] → 136 snapshots (~145 active stocks), val [4450:4550] → 36 snapshots
  Fold 87: train [4300:4500] → 136 snapshots (~145 active stocks), val [4500:4600] → 36 snapshots
  Fold 88: train [4350:4550] → 136 snapshots (~147 active stocks), val [4550:4650] → 36 snapshots
  Fold 89: train [4400:4600] → 136 snapshots (~148 active stocks), val [4600:4700] → 36 snapshots
  Fold 90: train [4450:4650] → 136 snapshots (~150 active stocks), val [4650:4750] → 36 snapshots

Ready for walk-forward backtest:
  90 folds, 150 stocks, 4 macro factors
HeteroGraphBuilder: Precomputed sector mask for 150 stocks.
  Sector constraints enabled. Found 12 sectors.

============================================================
FOLD 1/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: nan (Dir: nan, Mag: nan) | Rank Acc: 54.7% | Mag MAE: nan | LR: 0.000045
  Early stopping at epoch 24 (best val loss: 0.4496)
  Saved: ./backtest_results/training_curve_fold_1.png

Validating...
  Val Loss: 0.4496 (Dir: 0.4454, Mag: 0.0840)
  Rank Accuracy: 58.8%
  Mag MAE: 0.3375
  Checkpoint saved (1 folds complete)

============================================================
FOLD 2/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4674 (Dir: 0.4631, Mag: 0.0861) | Rank Acc: 56.1% | Mag MAE: 0.3439 | LR: 0.000045
  Early stopping at epoch 22 (best val loss: 0.4719)
  Saved: ./backtest_results/training_curve_fold_2.png

Validating...
  Val Loss: 0.4719 (Dir: 0.4675, Mag: 0.0880)
  Rank Accuracy: 55.0%
  Mag MAE: 0.3474
  Checkpoint saved (2 folds complete)

============================================================
FOLD 3/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4663 (Dir: 0.4620, Mag: 0.0849) | Rank Acc: 56.5% | Mag MAE: 0.3399 | LR: 0.000045
  Early stopping at epoch 35 (best val loss: 0.4370)
  Saved: ./backtest_results/training_curve_fold_3.png

Validating...
  Val Loss: 0.4370 (Dir: 0.4325, Mag: 0.0891)
  Rank Accuracy: 59.9%
  Mag MAE: 0.3538
  Checkpoint saved (3 folds complete)

============================================================
FOLD 4/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4683 (Dir: 0.4640, Mag: 0.0865) | Rank Acc: 56.2% | Mag MAE: 0.3426 | LR: 0.000045
  Early stopping at epoch 37 (best val loss: 0.4827)
  Saved: ./backtest_results/training_curve_fold_4.png

Validating...
  Val Loss: 0.4827 (Dir: 0.4784, Mag: 0.0879)
  Rank Accuracy: 53.9%
  Mag MAE: 0.3494
  Checkpoint saved (4 folds complete)

============================================================
FOLD 5/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 19 (best val loss: 0.4666)
  Saved: ./backtest_results/training_curve_fold_5.png

Validating...
  Val Loss: 0.4666 (Dir: 0.4622, Mag: 0.0871)
  Rank Accuracy: 58.4%
  Mag MAE: 0.3464
  Checkpoint saved (5 folds complete)

============================================================
FOLD 6/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 19 (best val loss: 0.4704)
  Saved: ./backtest_results/training_curve_fold_6.png

Validating...
  Val Loss: 0.4704 (Dir: 0.4662, Mag: 0.0845)
  Rank Accuracy: 56.3%
  Mag MAE: 0.3437
  Checkpoint saved (6 folds complete)

============================================================
FOLD 7/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4703 (Dir: 0.4658, Mag: 0.0887) | Rank Acc: 55.9% | Mag MAE: 0.3491 | LR: 0.000045
  Early stopping at epoch 22 (best val loss: 0.4745)
  Saved: ./backtest_results/training_curve_fold_7.png

Validating...
  Val Loss: 0.4745 (Dir: 0.4702, Mag: 0.0852)
  Rank Accuracy: 58.0%
  Mag MAE: 0.3399
  Checkpoint saved (7 folds complete)

============================================================
FOLD 8/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4783 (Dir: 0.4740, Mag: 0.0876) | Rank Acc: 54.7% | Mag MAE: 0.3485 | LR: 0.000045
  Early stopping at epoch 22 (best val loss: 0.4681)
  Saved: ./backtest_results/training_curve_fold_8.png

Validating...
  Val Loss: 0.4681 (Dir: 0.4638, Mag: 0.0850)
  Rank Accuracy: 56.3%
  Mag MAE: 0.3415
  Checkpoint saved (8 folds complete)

============================================================
FOLD 9/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 18 (best val loss: 0.4583)
  Saved: ./backtest_results/training_curve_fold_9.png

Validating...
  Val Loss: 0.4583 (Dir: 0.4540, Mag: 0.0860)
  Rank Accuracy: 58.1%
  Mag MAE: 0.3434
  Checkpoint saved (9 folds complete)

============================================================
FOLD 10/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 18 (best val loss: 0.4401)
  Saved: ./backtest_results/training_curve_fold_10.png

Validating...
  Val Loss: 0.4401 (Dir: 0.4355, Mag: 0.0905)
  Rank Accuracy: 60.4%
  Mag MAE: 0.3542
  Checkpoint saved (10 folds complete)

============================================================
FOLD 11/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4600 (Dir: 0.4557, Mag: 0.0849) | Rank Acc: 57.4% | Mag MAE: 0.3395 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4537 (Dir: 0.4495, Mag: 0.0845) | Rank Acc: 58.0% | Mag MAE: 0.3387 | LR: 0.000033
  Epoch 60/100 | Loss: 0.4500 (Dir: 0.4458, Mag: 0.0846) | Rank Acc: 58.1% | Mag MAE: 0.3391 | LR: 0.000018
  Epoch 80/100 | Loss: 0.4479 (Dir: 0.4437, Mag: 0.0845) | Rank Acc: 58.4% | Mag MAE: 0.3387 | LR: 0.000006
  Early stopping at epoch 85 (best val loss: 0.4512)
  Saved: ./backtest_results/training_curve_fold_11.png

Validating...
  Val Loss: 0.4512 (Dir: 0.4462, Mag: 0.1000)
  Rank Accuracy: 59.6%
  Mag MAE: 0.3759
  Checkpoint saved (11 folds complete)

============================================================
FOLD 12/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4532 (Dir: 0.4489, Mag: 0.0865) | Rank Acc: 58.1% | Mag MAE: 0.3447 | LR: 0.000045
  Early stopping at epoch 28 (best val loss: 0.4467)
  Saved: ./backtest_results/training_curve_fold_12.png

Validating...
  Val Loss: 0.4467 (Dir: 0.4423, Mag: 0.0877)
  Rank Accuracy: 59.3%
  Mag MAE: 0.3497
  Checkpoint saved (12 folds complete)

============================================================
FOLD 13/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4536 (Dir: 0.4491, Mag: 0.0918) | Rank Acc: 58.0% | Mag MAE: 0.3572 | LR: 0.000045
  Early stopping at epoch 20 (best val loss: 0.4613)
  Saved: ./backtest_results/training_curve_fold_13.png

Validating...
  Val Loss: 0.4613 (Dir: 0.4569, Mag: 0.0872)
  Rank Accuracy: 57.3%
  Mag MAE: 0.3494
  Checkpoint saved (13 folds complete)

============================================================
FOLD 14/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4547 (Dir: 0.4501, Mag: 0.0917) | Rank Acc: 57.9% | Mag MAE: 0.3572 | LR: 0.000045
  Early stopping at epoch 35 (best val loss: 0.4649)
  Saved: ./backtest_results/training_curve_fold_14.png

Validating...
  Val Loss: 0.4649 (Dir: 0.4605, Mag: 0.0883)
  Rank Accuracy: 56.4%
  Mag MAE: 0.3528
  Checkpoint saved (14 folds complete)

============================================================
FOLD 15/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4618 (Dir: 0.4571, Mag: 0.0933) | Rank Acc: 56.7% | Mag MAE: 0.3603 | LR: 0.000045
  Early stopping at epoch 20 (best val loss: 0.4485)
  Saved: ./backtest_results/training_curve_fold_15.png

Validating...
  Val Loss: 0.4485 (Dir: 0.4431, Mag: 0.1096)
  Rank Accuracy: 58.1%
  Mag MAE: 0.4000
  Checkpoint saved (15 folds complete)

============================================================
FOLD 16/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4627 (Dir: 0.4583, Mag: 0.0883) | Rank Acc: 57.0% | Mag MAE: 0.3515 | LR: 0.000045
  Early stopping at epoch 27 (best val loss: 0.4594)
  Saved: ./backtest_results/training_curve_fold_16.png

Validating...
  Val Loss: 0.4594 (Dir: 0.4552, Mag: 0.0856)
  Rank Accuracy: 57.7%
  Mag MAE: 0.3402
  Checkpoint saved (16 folds complete)

============================================================
FOLD 17/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4619 (Dir: 0.4573, Mag: 0.0924) | Rank Acc: 56.8% | Mag MAE: 0.3590 | LR: 0.000045
  Early stopping at epoch 28 (best val loss: 0.4746)
  Saved: ./backtest_results/training_curve_fold_17.png

Validating...
  Val Loss: 0.4746 (Dir: 0.4703, Mag: 0.0856)
  Rank Accuracy: 54.3%
  Mag MAE: 0.3418
  Checkpoint saved (17 folds complete)

============================================================
FOLD 18/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 17 (best val loss: 0.4872)
  Saved: ./backtest_results/training_curve_fold_18.png

Validating...
  Val Loss: 0.4872 (Dir: 0.4829, Mag: 0.0864)
  Rank Accuracy: 52.8%
  Mag MAE: 0.3449
  Checkpoint saved (18 folds complete)

============================================================
FOLD 19/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 16 (best val loss: 0.4695)
  Saved: ./backtest_results/training_curve_fold_19.png

Validating...
  Val Loss: 0.4695 (Dir: 0.4652, Mag: 0.0870)
  Rank Accuracy: 58.2%
  Mag MAE: 0.3437
  Checkpoint saved (19 folds complete)

============================================================
FOLD 20/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 14 (best val loss: 0.4991)
  Saved: ./backtest_results/training_curve_fold_20.png

Validating...
  Val Loss: 0.4991 (Dir: 0.4940, Mag: 0.1016)
  Rank Accuracy: 56.4%
  Mag MAE: 0.3843
  Checkpoint saved (20 folds complete)

============================================================
FOLD 21/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 13 (best val loss: 0.4991)
  Saved: ./backtest_results/training_curve_fold_21.png

Validating...
  Val Loss: 0.4991 (Dir: 0.4947, Mag: 0.0880)
  Rank Accuracy: 54.9%
  Mag MAE: 0.3391
  Checkpoint saved (21 folds complete)

============================================================
FOLD 22/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 16 (best val loss: 0.4651)
  Saved: ./backtest_results/training_curve_fold_22.png

Validating...
  Val Loss: 0.4651 (Dir: 0.4602, Mag: 0.0993)
  Rank Accuracy: 56.2%
  Mag MAE: 0.3769
  Checkpoint saved (22 folds complete)

============================================================
FOLD 23/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4604 (Dir: 0.4557, Mag: 0.0951) | Rank Acc: 57.2% | Mag MAE: 0.3650 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4542 (Dir: 0.4494, Mag: 0.0944) | Rank Acc: 57.9% | Mag MAE: 0.3639 | LR: 0.000033
  Epoch 60/100 | Loss: 0.4516 (Dir: 0.4469, Mag: 0.0941) | Rank Acc: 58.1% | Mag MAE: 0.3630 | LR: 0.000018
  Early stopping at epoch 75 (best val loss: 0.4384)
  Saved: ./backtest_results/training_curve_fold_23.png

Validating...
  Val Loss: 0.4384 (Dir: 0.4341, Mag: 0.0862)
  Rank Accuracy: 60.1%
  Mag MAE: 0.3455
  Checkpoint saved (23 folds complete)

============================================================
FOLD 24/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4684 (Dir: 0.4636, Mag: 0.0967) | Rank Acc: 56.2% | Mag MAE: 0.3683 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4618 (Dir: 0.4570, Mag: 0.0960) | Rank Acc: 56.7% | Mag MAE: 0.3673 | LR: 0.000033
  Epoch 60/100 | Loss: 0.4582 (Dir: 0.4534, Mag: 0.0959) | Rank Acc: 57.2% | Mag MAE: 0.3674 | LR: 0.000018
  Early stopping at epoch 61 (best val loss: 0.4507)
  Saved: ./backtest_results/training_curve_fold_24.png

Validating...
  Val Loss: 0.4507 (Dir: 0.4463, Mag: 0.0886)
  Rank Accuracy: 58.2%
  Mag MAE: 0.3424
  Checkpoint saved (24 folds complete)

============================================================
FOLD 25/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4643 (Dir: 0.4597, Mag: 0.0917) | Rank Acc: 56.8% | Mag MAE: 0.3566 | LR: 0.000045
  Early stopping at epoch 33 (best val loss: 0.4370)
  Saved: ./backtest_results/training_curve_fold_25.png

Validating...
  Val Loss: 0.4370 (Dir: 0.4312, Mag: 0.1164)
  Rank Accuracy: 60.2%
  Mag MAE: 0.4184
  Checkpoint saved (25 folds complete)

============================================================
FOLD 26/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4647 (Dir: 0.4602, Mag: 0.0913) | Rank Acc: 56.6% | Mag MAE: 0.3547 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4569 (Dir: 0.4524, Mag: 0.0910) | Rank Acc: 57.3% | Mag MAE: 0.3546 | LR: 0.000033
  Epoch 60/100 | Loss: 0.4543 (Dir: 0.4497, Mag: 0.0909) | Rank Acc: 57.8% | Mag MAE: 0.3541 | LR: 0.000018
  Early stopping at epoch 67 (best val loss: 0.4628)
  Saved: ./backtest_results/training_curve_fold_26.png

Validating...
  Val Loss: 0.4628 (Dir: 0.4585, Mag: 0.0866)
  Rank Accuracy: 56.7%
  Mag MAE: 0.3463
  Checkpoint saved (26 folds complete)

============================================================
FOLD 27/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 16 (best val loss: 0.4574)
  Saved: ./backtest_results/training_curve_fold_27.png

Validating...
  Val Loss: 0.4574 (Dir: 0.4530, Mag: 0.0864)
  Rank Accuracy: 57.8%
  Mag MAE: 0.3430
  Checkpoint saved (27 folds complete)

============================================================
FOLD 28/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4615 (Dir: 0.4568, Mag: 0.0939) | Rank Acc: 56.8% | Mag MAE: 0.3610 | LR: 0.000045
  Early stopping at epoch 29 (best val loss: 0.4462)
  Saved: ./backtest_results/training_curve_fold_28.png

Validating...
  Val Loss: 0.4462 (Dir: 0.4421, Mag: 0.0838)
  Rank Accuracy: 60.0%
  Mag MAE: 0.3350
  Checkpoint saved (28 folds complete)

============================================================
FOLD 29/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4606 (Dir: 0.4558, Mag: 0.0950) | Rank Acc: 57.1% | Mag MAE: 0.3648 | LR: 0.000045
  Early stopping at epoch 31 (best val loss: 0.4541)
  Saved: ./backtest_results/training_curve_fold_29.png

Validating...
  Val Loss: 0.4541 (Dir: 0.4498, Mag: 0.0857)
  Rank Accuracy: 57.6%
  Mag MAE: 0.3424
  Checkpoint saved (29 folds complete)

============================================================
FOLD 30/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4598 (Dir: 0.4554, Mag: 0.0871) | Rank Acc: 57.2% | Mag MAE: 0.3459 | LR: 0.000045
  Early stopping at epoch 20 (best val loss: 0.4544)
  Saved: ./backtest_results/training_curve_fold_30.png

Validating...
  Val Loss: 0.4544 (Dir: 0.4502, Mag: 0.0841)
  Rank Accuracy: 57.6%
  Mag MAE: 0.3371
  Checkpoint saved (30 folds complete)

============================================================
FOLD 31/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 19 (best val loss: 0.4506)
  Saved: ./backtest_results/training_curve_fold_31.png

Validating...
  Val Loss: 0.4506 (Dir: 0.4462, Mag: 0.0873)
  Rank Accuracy: 58.3%
  Mag MAE: 0.3498
  Checkpoint saved (31 folds complete)

============================================================
FOLD 32/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4574 (Dir: 0.4532, Mag: 0.0854) | Rank Acc: 57.5% | Mag MAE: 0.3410 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4516 (Dir: 0.4473, Mag: 0.0848) | Rank Acc: 58.2% | Mag MAE: 0.3399 | LR: 0.000033
  Epoch 60/100 | Loss: 0.4492 (Dir: 0.4449, Mag: 0.0846) | Rank Acc: 58.6% | Mag MAE: 0.3395 | LR: 0.000018
  Early stopping at epoch 67 (best val loss: 0.4628)
  Saved: ./backtest_results/training_curve_fold_32.png

Validating...
  Val Loss: 0.4628 (Dir: 0.4585, Mag: 0.0844)
  Rank Accuracy: 56.3%
  Mag MAE: 0.3396
  Checkpoint saved (32 folds complete)

============================================================
FOLD 33/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4602 (Dir: 0.4558, Mag: 0.0879) | Rank Acc: 57.4% | Mag MAE: 0.3450 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4549 (Dir: 0.4506, Mag: 0.0867) | Rank Acc: 58.0% | Mag MAE: 0.3446 | LR: 0.000033
  Early stopping at epoch 47 (best val loss: 0.4421)
  Saved: ./backtest_results/training_curve_fold_33.png

Validating...
  Val Loss: 0.4421 (Dir: 0.4368, Mag: 0.1043)
  Rank Accuracy: 60.7%
  Mag MAE: 0.3908
  Checkpoint saved (33 folds complete)

============================================================
FOLD 34/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4572 (Dir: 0.4529, Mag: 0.0873) | Rank Acc: 57.4% | Mag MAE: 0.3450 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4526 (Dir: 0.4482, Mag: 0.0868) | Rank Acc: 57.9% | Mag MAE: 0.3441 | LR: 0.000033
  Early stopping at epoch 45 (best val loss: 0.4519)
  Saved: ./backtest_results/training_curve_fold_34.png

Validating...
  Val Loss: 0.4519 (Dir: 0.4476, Mag: 0.0869)
  Rank Accuracy: 58.7%
  Mag MAE: 0.3450
  Checkpoint saved (34 folds complete)

============================================================
FOLD 35/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 17 (best val loss: 0.4808)
  Saved: ./backtest_results/training_curve_fold_35.png

Validating...
  Val Loss: 0.4808 (Dir: 0.4751, Mag: 0.1142)
  Rank Accuracy: 56.4%
  Mag MAE: 0.4127
  Checkpoint saved (35 folds complete)

============================================================
FOLD 36/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 14 (best val loss: 0.4967)
  Saved: ./backtest_results/training_curve_fold_36.png

Validating...
  Val Loss: 0.4967 (Dir: 0.4924, Mag: 0.0871)
  Rank Accuracy: 59.1%
  Mag MAE: 0.3468
  Checkpoint saved (36 folds complete)

============================================================
FOLD 37/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 14 (best val loss: 0.4976)
  Saved: ./backtest_results/training_curve_fold_37.png

Validating...
  Val Loss: 0.4976 (Dir: 0.4922, Mag: 0.1079)
  Rank Accuracy: 56.0%
  Mag MAE: 0.3946
  Checkpoint saved (37 folds complete)

============================================================
FOLD 38/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 14 (best val loss: 0.4940)
  Saved: ./backtest_results/training_curve_fold_38.png

Validating...
  Val Loss: 0.4940 (Dir: 0.4893, Mag: 0.0939)
  Rank Accuracy: 52.7%
  Mag MAE: 0.3657
  Checkpoint saved (38 folds complete)

============================================================
FOLD 39/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4617 (Dir: 0.4569, Mag: 0.0960) | Rank Acc: 57.2% | Mag MAE: 0.3684 | LR: 0.000045
  Early stopping at epoch 32 (best val loss: 0.4703)
  Saved: ./backtest_results/training_curve_fold_39.png

Validating...
  Val Loss: 0.4703 (Dir: 0.4645, Mag: 0.1143)
  Rank Accuracy: 56.1%
  Mag MAE: 0.4191
  Checkpoint saved (39 folds complete)

============================================================
FOLD 40/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4630 (Dir: 0.4583, Mag: 0.0930) | Rank Acc: 56.9% | Mag MAE: 0.3613 | LR: 0.000045
  Early stopping at epoch 34 (best val loss: 0.4356)
  Saved: ./backtest_results/training_curve_fold_40.png

Validating...
  Val Loss: 0.4356 (Dir: 0.4312, Mag: 0.0880)
  Rank Accuracy: 59.9%
  Mag MAE: 0.3454
  Checkpoint saved (40 folds complete)

============================================================
FOLD 41/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4717 (Dir: 0.4668, Mag: 0.0988) | Rank Acc: 56.0% | Mag MAE: 0.3756 | LR: 0.000045
  Early stopping at epoch 23 (best val loss: 0.4501)
  Saved: ./backtest_results/training_curve_fold_41.png

Validating...
  Val Loss: 0.4501 (Dir: 0.4455, Mag: 0.0921)
  Rank Accuracy: 59.9%
  Mag MAE: 0.3497
  Checkpoint saved (41 folds complete)

============================================================
FOLD 42/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4652 (Dir: 0.4603, Mag: 0.0972) | Rank Acc: 56.6% | Mag MAE: 0.3718 | LR: 0.000045
  Early stopping at epoch 22 (best val loss: 0.4616)
  Saved: ./backtest_results/training_curve_fold_42.png

Validating...
  Val Loss: 0.4616 (Dir: 0.4572, Mag: 0.0881)
  Rank Accuracy: 56.8%
  Mag MAE: 0.3458
  Checkpoint saved (42 folds complete)

============================================================
FOLD 43/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4634 (Dir: 0.4586, Mag: 0.0966) | Rank Acc: 56.9% | Mag MAE: 0.3682 | LR: 0.000045
  Early stopping at epoch 30 (best val loss: 0.4559)
  Saved: ./backtest_results/training_curve_fold_43.png

Validating...
  Val Loss: 0.4559 (Dir: 0.4509, Mag: 0.1001)
  Rank Accuracy: 58.8%
  Mag MAE: 0.3846
  Checkpoint saved (43 folds complete)

============================================================
FOLD 44/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4600 (Dir: 0.4556, Mag: 0.0871) | Rank Acc: 57.3% | Mag MAE: 0.3451 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4549 (Dir: 0.4506, Mag: 0.0863) | Rank Acc: 57.7% | Mag MAE: 0.3436 | LR: 0.000033
  Epoch 60/100 | Loss: 0.4508 (Dir: 0.4465, Mag: 0.0861) | Rank Acc: 58.3% | Mag MAE: 0.3435 | LR: 0.000018
  Early stopping at epoch 68 (best val loss: 0.4458)
  Saved: ./backtest_results/training_curve_fold_44.png

Validating...
  Val Loss: 0.4458 (Dir: 0.4414, Mag: 0.0864)
  Rank Accuracy: 59.1%
  Mag MAE: 0.3459
  Checkpoint saved (44 folds complete)

============================================================
FOLD 45/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4604 (Dir: 0.4557, Mag: 0.0926) | Rank Acc: 57.0% | Mag MAE: 0.3585 | LR: 0.000045
  Early stopping at epoch 27 (best val loss: 0.4680)
  Saved: ./backtest_results/training_curve_fold_45.png

Validating...
  Val Loss: 0.4680 (Dir: 0.4634, Mag: 0.0911)
  Rank Accuracy: 56.4%
  Mag MAE: 0.3560
  Checkpoint saved (45 folds complete)

============================================================
FOLD 46/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4568 (Dir: 0.4523, Mag: 0.0919) | Rank Acc: 57.3% | Mag MAE: 0.3590 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4531 (Dir: 0.4485, Mag: 0.0918) | Rank Acc: 57.9% | Mag MAE: 0.3592 | LR: 0.000033
  Epoch 60/100 | Loss: 0.4489 (Dir: 0.4444, Mag: 0.0916) | Rank Acc: 58.2% | Mag MAE: 0.3591 | LR: 0.000018
  Epoch 80/100 | Loss: 0.4461 (Dir: 0.4415, Mag: 0.0915) | Rank Acc: 58.8% | Mag MAE: 0.3588 | LR: 0.000006
  Early stopping at epoch 85 (best val loss: 0.4513)
  Saved: ./backtest_results/training_curve_fold_46.png

Validating...
  Val Loss: 0.4513 (Dir: 0.4471, Mag: 0.0851)
  Rank Accuracy: 57.9%
  Mag MAE: 0.3408
  Checkpoint saved (46 folds complete)

============================================================
FOLD 47/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 15 (best val loss: 0.4850)
  Saved: ./backtest_results/training_curve_fold_47.png

Validating...
  Val Loss: 0.4850 (Dir: 0.4807, Mag: 0.0865)
  Rank Accuracy: 53.2%
  Mag MAE: 0.3444
  Checkpoint saved (47 folds complete)

============================================================
FOLD 48/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4606 (Dir: 0.4562, Mag: 0.0874) | Rank Acc: 57.0% | Mag MAE: 0.3477 | LR: 0.000045
  Early stopping at epoch 26 (best val loss: 0.4417)
  Saved: ./backtest_results/training_curve_fold_48.png

Validating...
  Val Loss: 0.4417 (Dir: 0.4372, Mag: 0.0897)
  Rank Accuracy: 59.4%
  Mag MAE: 0.3549
  Checkpoint saved (48 folds complete)

============================================================
FOLD 49/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4659 (Dir: 0.4615, Mag: 0.0887) | Rank Acc: 56.1% | Mag MAE: 0.3503 | LR: 0.000045
  Early stopping at epoch 21 (best val loss: 0.4515)
  Saved: ./backtest_results/training_curve_fold_49.png

Validating...
  Val Loss: 0.4515 (Dir: 0.4470, Mag: 0.0901)
  Rank Accuracy: 59.4%
  Mag MAE: 0.3577
  Checkpoint saved (49 folds complete)

============================================================
FOLD 50/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4691 (Dir: 0.4647, Mag: 0.0877) | Rank Acc: 56.1% | Mag MAE: 0.3467 | LR: 0.000045
  Early stopping at epoch 21 (best val loss: 0.4737)
  Saved: ./backtest_results/training_curve_fold_50.png

Validating...
  Val Loss: 0.4737 (Dir: 0.4692, Mag: 0.0900)
  Rank Accuracy: 55.0%
  Mag MAE: 0.3544
  Checkpoint saved (50 folds complete)

============================================================
FOLD 51/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4709 (Dir: 0.4664, Mag: 0.0897) | Rank Acc: 55.6% | Mag MAE: 0.3531 | LR: 0.000045
  Early stopping at epoch 22 (best val loss: 0.4659)
  Saved: ./backtest_results/training_curve_fold_51.png

Validating...
  Val Loss: 0.4659 (Dir: 0.4615, Mag: 0.0875)
  Rank Accuracy: 56.0%
  Mag MAE: 0.3487
  Checkpoint saved (51 folds complete)

============================================================
FOLD 52/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4697 (Dir: 0.4652, Mag: 0.0903) | Rank Acc: 56.0% | Mag MAE: 0.3555 | LR: 0.000045
  Early stopping at epoch 24 (best val loss: 0.4693)
  Saved: ./backtest_results/training_curve_fold_52.png

Validating...
  Val Loss: 0.4693 (Dir: 0.4648, Mag: 0.0885)
  Rank Accuracy: 57.2%
  Mag MAE: 0.3495
  Checkpoint saved (52 folds complete)

============================================================
FOLD 53/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4683 (Dir: 0.4638, Mag: 0.0896) | Rank Acc: 55.9% | Mag MAE: 0.3553 | LR: 0.000045
  Early stopping at epoch 26 (best val loss: 0.4542)
  Saved: ./backtest_results/training_curve_fold_53.png

Validating...
  Val Loss: 0.4542 (Dir: 0.4497, Mag: 0.0901)
  Rank Accuracy: 58.2%
  Mag MAE: 0.3566
  Checkpoint saved (53 folds complete)

============================================================
FOLD 54/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4687 (Dir: 0.4642, Mag: 0.0890) | Rank Acc: 55.7% | Mag MAE: 0.3530 | LR: 0.000045
  Early stopping at epoch 20 (best val loss: 0.4552)
  Saved: ./backtest_results/training_curve_fold_54.png

Validating...
  Val Loss: 0.4552 (Dir: 0.4509, Mag: 0.0867)
  Rank Accuracy: 57.0%
  Mag MAE: 0.3464
  Checkpoint saved (54 folds complete)

============================================================
FOLD 55/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4571 (Dir: 0.4527, Mag: 0.0891) | Rank Acc: 57.4% | Mag MAE: 0.3521 | LR: 0.000045
  Early stopping at epoch 34 (best val loss: 0.4793)
  Saved: ./backtest_results/training_curve_fold_55.png

Validating...
  Val Loss: 0.4793 (Dir: 0.4750, Mag: 0.0866)
  Rank Accuracy: 54.0%
  Mag MAE: 0.3464
  Checkpoint saved (55 folds complete)

============================================================
FOLD 56/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4589 (Dir: 0.4544, Mag: 0.0897) | Rank Acc: 57.1% | Mag MAE: 0.3531 | LR: 0.000045
  Early stopping at epoch 35 (best val loss: 0.4508)
  Saved: ./backtest_results/training_curve_fold_56.png

Validating...
  Val Loss: 0.4508 (Dir: 0.4467, Mag: 0.0831)
  Rank Accuracy: 59.1%
  Mag MAE: 0.3337
  Checkpoint saved (56 folds complete)

============================================================
FOLD 57/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4654 (Dir: 0.4611, Mag: 0.0877) | Rank Acc: 56.5% | Mag MAE: 0.3486 | LR: 0.000045
  Early stopping at epoch 27 (best val loss: 0.4713)
  Saved: ./backtest_results/training_curve_fold_57.png

Validating...
  Val Loss: 0.4713 (Dir: 0.4669, Mag: 0.0875)
  Rank Accuracy: 55.1%
  Mag MAE: 0.3498
  Checkpoint saved (57 folds complete)

============================================================
FOLD 58/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 17 (best val loss: 0.4543)
  Saved: ./backtest_results/training_curve_fold_58.png

Validating...
  Val Loss: 0.4543 (Dir: 0.4500, Mag: 0.0866)
  Rank Accuracy: 58.0%
  Mag MAE: 0.3467
  Checkpoint saved (58 folds complete)

============================================================
FOLD 59/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 15 (best val loss: 0.4776)
  Saved: ./backtest_results/training_curve_fold_59.png

Validating...
  Val Loss: 0.4776 (Dir: 0.4733, Mag: 0.0871)
  Rank Accuracy: 58.9%
  Mag MAE: 0.3464
  Checkpoint saved (59 folds complete)

============================================================
FOLD 60/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 14 (best val loss: 0.4835)
  Saved: ./backtest_results/training_curve_fold_60.png

Validating...
  Val Loss: 0.4835 (Dir: 0.4791, Mag: 0.0871)
  Rank Accuracy: 58.9%
  Mag MAE: 0.3458
  Checkpoint saved (60 folds complete)

============================================================
FOLD 61/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 17 (best val loss: 0.4991)
  Saved: ./backtest_results/training_curve_fold_61.png

Validating...
  Val Loss: 0.4991 (Dir: 0.4949, Mag: 0.0855)
  Rank Accuracy: 52.4%
  Mag MAE: 0.3435
  Checkpoint saved (61 folds complete)

============================================================
FOLD 62/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4649 (Dir: 0.4605, Mag: 0.0872) | Rank Acc: 56.3% | Mag MAE: 0.3463 | LR: 0.000045
  Early stopping at epoch 22 (best val loss: 0.4733)
  Saved: ./backtest_results/training_curve_fold_62.png

Validating...
  Val Loss: 0.4733 (Dir: 0.4688, Mag: 0.0887)
  Rank Accuracy: 58.6%
  Mag MAE: 0.3531
  Checkpoint saved (62 folds complete)

============================================================
FOLD 63/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 18 (best val loss: 0.4689)
  Saved: ./backtest_results/training_curve_fold_63.png

Validating...
  Val Loss: 0.4689 (Dir: 0.4646, Mag: 0.0850)
  Rank Accuracy: 55.8%
  Mag MAE: 0.3423
  Checkpoint saved (63 folds complete)

============================================================
FOLD 64/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4645 (Dir: 0.4601, Mag: 0.0878) | Rank Acc: 56.3% | Mag MAE: 0.3485 | LR: 0.000045
  Early stopping at epoch 27 (best val loss: 0.4467)
  Saved: ./backtest_results/training_curve_fold_64.png

Validating...
  Val Loss: 0.4467 (Dir: 0.4424, Mag: 0.0857)
  Rank Accuracy: 58.3%
  Mag MAE: 0.3438
  Checkpoint saved (64 folds complete)

============================================================
FOLD 65/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4737 (Dir: 0.4694, Mag: 0.0869) | Rank Acc: 55.0% | Mag MAE: 0.3463 | LR: 0.000045
  Early stopping at epoch 28 (best val loss: 0.4501)
  Saved: ./backtest_results/training_curve_fold_65.png

Validating...
  Val Loss: 0.4501 (Dir: 0.4457, Mag: 0.0871)
  Rank Accuracy: 59.4%
  Mag MAE: 0.3468
  Checkpoint saved (65 folds complete)

============================================================
FOLD 66/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4581 (Dir: 0.4538, Mag: 0.0870) | Rank Acc: 57.5% | Mag MAE: 0.3449 | LR: 0.000045
  Early stopping at epoch 22 (best val loss: 0.4641)
  Saved: ./backtest_results/training_curve_fold_66.png

Validating...
  Val Loss: 0.4641 (Dir: 0.4597, Mag: 0.0881)
  Rank Accuracy: 57.2%
  Mag MAE: 0.3486
  Checkpoint saved (66 folds complete)

============================================================
FOLD 67/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4555 (Dir: 0.4512, Mag: 0.0862) | Rank Acc: 57.7% | Mag MAE: 0.3441 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4499 (Dir: 0.4456, Mag: 0.0858) | Rank Acc: 58.3% | Mag MAE: 0.3433 | LR: 0.000033
  Epoch 60/100 | Loss: 0.4490 (Dir: 0.4447, Mag: 0.0858) | Rank Acc: 58.2% | Mag MAE: 0.3432 | LR: 0.000018
  Early stopping at epoch 68 (best val loss: 0.4636)
  Saved: ./backtest_results/training_curve_fold_67.png

Validating...
  Val Loss: 0.4636 (Dir: 0.4592, Mag: 0.0879)
  Rank Accuracy: 57.5%
  Mag MAE: 0.3495
  Checkpoint saved (67 folds complete)

============================================================
FOLD 68/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4634 (Dir: 0.4589, Mag: 0.0887) | Rank Acc: 56.9% | Mag MAE: 0.3505 | LR: 0.000045
  Early stopping at epoch 38 (best val loss: 0.4528)
  Saved: ./backtest_results/training_curve_fold_68.png

Validating...
  Val Loss: 0.4528 (Dir: 0.4485, Mag: 0.0852)
  Rank Accuracy: 58.5%
  Mag MAE: 0.3413
  Checkpoint saved (68 folds complete)

============================================================
FOLD 69/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4623 (Dir: 0.4578, Mag: 0.0899) | Rank Acc: 57.0% | Mag MAE: 0.3537 | LR: 0.000045
  Early stopping at epoch 39 (best val loss: 0.4366)
  Saved: ./backtest_results/training_curve_fold_69.png

Validating...
  Val Loss: 0.4366 (Dir: 0.4321, Mag: 0.0886)
  Rank Accuracy: 61.0%
  Mag MAE: 0.3495
  Checkpoint saved (69 folds complete)

============================================================
FOLD 70/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 19 (best val loss: 0.4613)
  Saved: ./backtest_results/training_curve_fold_70.png

Validating...
  Val Loss: 0.4613 (Dir: 0.4570, Mag: 0.0863)
  Rank Accuracy: 57.5%
  Mag MAE: 0.3450
  Checkpoint saved (70 folds complete)

============================================================
FOLD 71/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4622 (Dir: 0.4578, Mag: 0.0877) | Rank Acc: 56.9% | Mag MAE: 0.3483 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4550 (Dir: 0.4506, Mag: 0.0875) | Rank Acc: 57.6% | Mag MAE: 0.3483 | LR: 0.000033
  Early stopping at epoch 57 (best val loss: 0.4776)
  Saved: ./backtest_results/training_curve_fold_71.png

Validating...
  Val Loss: 0.4776 (Dir: 0.4733, Mag: 0.0868)
  Rank Accuracy: 54.4%
  Mag MAE: 0.3491
  Checkpoint saved (71 folds complete)

============================================================
FOLD 72/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4612 (Dir: 0.4568, Mag: 0.0872) | Rank Acc: 56.9% | Mag MAE: 0.3460 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4531 (Dir: 0.4488, Mag: 0.0864) | Rank Acc: 57.8% | Mag MAE: 0.3449 | LR: 0.000033
  Epoch 60/100 | Loss: 0.4510 (Dir: 0.4466, Mag: 0.0865) | Rank Acc: 58.3% | Mag MAE: 0.3453 | LR: 0.000018
  Early stopping at epoch 60 (best val loss: 0.4589)
  Saved: ./backtest_results/training_curve_fold_72.png

Validating...
  Val Loss: 0.4589 (Dir: 0.4545, Mag: 0.0884)
  Rank Accuracy: 58.4%
  Mag MAE: 0.3521
  Checkpoint saved (72 folds complete)

============================================================
FOLD 73/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4607 (Dir: 0.4563, Mag: 0.0878) | Rank Acc: 57.1% | Mag MAE: 0.3484 | LR: 0.000045
  Early stopping at epoch 29 (best val loss: 0.4682)
  Saved: ./backtest_results/training_curve_fold_73.png

Validating...
  Val Loss: 0.4682 (Dir: 0.4638, Mag: 0.0879)
  Rank Accuracy: 59.4%
  Mag MAE: 0.3498
  Checkpoint saved (73 folds complete)

============================================================
FOLD 74/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4667 (Dir: 0.4623, Mag: 0.0890) | Rank Acc: 56.2% | Mag MAE: 0.3516 | LR: 0.000045
  Early stopping at epoch 29 (best val loss: 0.4535)
  Saved: ./backtest_results/training_curve_fold_74.png

Validating...
  Val Loss: 0.4535 (Dir: 0.4492, Mag: 0.0855)
  Rank Accuracy: 59.5%
  Mag MAE: 0.3394
  Checkpoint saved (74 folds complete)

============================================================
FOLD 75/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4645 (Dir: 0.4600, Mag: 0.0892) | Rank Acc: 56.8% | Mag MAE: 0.3524 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4602 (Dir: 0.4558, Mag: 0.0886) | Rank Acc: 57.1% | Mag MAE: 0.3511 | LR: 0.000033
  Early stopping at epoch 42 (best val loss: 0.4440)
  Saved: ./backtest_results/training_curve_fold_75.png

Validating...
  Val Loss: 0.4440 (Dir: 0.4397, Mag: 0.0857)
  Rank Accuracy: 59.7%
  Mag MAE: 0.3435
  Checkpoint saved (75 folds complete)

============================================================
FOLD 76/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4542 (Dir: 0.4498, Mag: 0.0875) | Rank Acc: 58.0% | Mag MAE: 0.3483 | LR: 0.000045
  Early stopping at epoch 25 (best val loss: 0.4315)
  Saved: ./backtest_results/training_curve_fold_76.png

Validating...
  Val Loss: 0.4315 (Dir: 0.4269, Mag: 0.0936)
  Rank Accuracy: 60.5%
  Mag MAE: 0.3656
  Checkpoint saved (76 folds complete)

============================================================
FOLD 77/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4585 (Dir: 0.4541, Mag: 0.0867) | Rank Acc: 57.3% | Mag MAE: 0.3459 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4483 (Dir: 0.4440, Mag: 0.0863) | Rank Acc: 58.5% | Mag MAE: 0.3451 | LR: 0.000033
  Early stopping at epoch 40 (best val loss: 0.4615)
  Saved: ./backtest_results/training_curve_fold_77.png

Validating...
  Val Loss: 0.4615 (Dir: 0.4571, Mag: 0.0875)
  Rank Accuracy: 56.8%
  Mag MAE: 0.3507
  Checkpoint saved (77 folds complete)

============================================================
FOLD 78/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4463 (Dir: 0.4419, Mag: 0.0878) | Rank Acc: 58.9% | Mag MAE: 0.3470 | LR: 0.000045
  Early stopping at epoch 31 (best val loss: 0.4558)
  Saved: ./backtest_results/training_curve_fold_78.png

Validating...
  Val Loss: 0.4558 (Dir: 0.4514, Mag: 0.0867)
  Rank Accuracy: 58.4%
  Mag MAE: 0.3434
  Checkpoint saved (78 folds complete)

============================================================
FOLD 79/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4522 (Dir: 0.4478, Mag: 0.0890) | Rank Acc: 58.3% | Mag MAE: 0.3514 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4454 (Dir: 0.4410, Mag: 0.0888) | Rank Acc: 59.0% | Mag MAE: 0.3514 | LR: 0.000033
  Early stopping at epoch 47 (best val loss: 0.4564)
  Saved: ./backtest_results/training_curve_fold_79.png

Validating...
  Val Loss: 0.4564 (Dir: 0.4521, Mag: 0.0864)
  Rank Accuracy: 57.9%
  Mag MAE: 0.3457
  Checkpoint saved (79 folds complete)

============================================================
FOLD 80/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4547 (Dir: 0.4503, Mag: 0.0883) | Rank Acc: 58.0% | Mag MAE: 0.3470 | LR: 0.000045
  Epoch 40/100 | Loss: 0.4495 (Dir: 0.4451, Mag: 0.0877) | Rank Acc: 58.6% | Mag MAE: 0.3466 | LR: 0.000033
  Early stopping at epoch 56 (best val loss: 0.4450)
  Saved: ./backtest_results/training_curve_fold_80.png

Validating...
  Val Loss: 0.4450 (Dir: 0.4407, Mag: 0.0843)
  Rank Accuracy: 59.0%
  Mag MAE: 0.3386
  Checkpoint saved (80 folds complete)

============================================================
FOLD 81/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4591 (Dir: 0.4548, Mag: 0.0868) | Rank Acc: 57.3% | Mag MAE: 0.3464 | LR: 0.000045
  Early stopping at epoch 21 (best val loss: 0.4816)
  Saved: ./backtest_results/training_curve_fold_81.png

Validating...
  Val Loss: 0.4816 (Dir: 0.4774, Mag: 0.0854)
  Rank Accuracy: 55.3%
  Mag MAE: 0.3412
  Checkpoint saved (81 folds complete)

============================================================
FOLD 82/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 14 (best val loss: 0.4611)
  Saved: ./backtest_results/training_curve_fold_82.png

Validating...
  Val Loss: 0.4611 (Dir: 0.4569, Mag: 0.0843)
  Rank Accuracy: 55.8%
  Mag MAE: 0.3389
  Checkpoint saved (82 folds complete)

============================================================
FOLD 83/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4604 (Dir: 0.4561, Mag: 0.0860) | Rank Acc: 57.1% | Mag MAE: 0.3434 | LR: 0.000045
  Early stopping at epoch 29 (best val loss: 0.4450)
  Saved: ./backtest_results/training_curve_fold_83.png

Validating...
  Val Loss: 0.4450 (Dir: 0.4407, Mag: 0.0873)
  Rank Accuracy: 58.9%
  Mag MAE: 0.3487
  Checkpoint saved (83 folds complete)

============================================================
FOLD 84/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 18 (best val loss: 0.4629)
  Saved: ./backtest_results/training_curve_fold_84.png

Validating...
  Val Loss: 0.4629 (Dir: 0.4585, Mag: 0.0896)
  Rank Accuracy: 56.7%
  Mag MAE: 0.3512
  Checkpoint saved (84 folds complete)

============================================================
FOLD 85/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4632 (Dir: 0.4588, Mag: 0.0871) | Rank Acc: 56.6% | Mag MAE: 0.3456 | LR: 0.000045
  Early stopping at epoch 24 (best val loss: 0.4591)
  Saved: ./backtest_results/training_curve_fold_85.png

Validating...
  Val Loss: 0.4591 (Dir: 0.4550, Mag: 0.0834)
  Rank Accuracy: 57.4%
  Mag MAE: 0.3369
  Checkpoint saved (85 folds complete)

============================================================
FOLD 86/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 19 (best val loss: 0.4619)
  Saved: ./backtest_results/training_curve_fold_86.png

Validating...
  Val Loss: 0.4619 (Dir: 0.4576, Mag: 0.0864)
  Rank Accuracy: 56.5%
  Mag MAE: 0.3446
  Checkpoint saved (86 folds complete)

============================================================
FOLD 87/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4682 (Dir: 0.4639, Mag: 0.0874) | Rank Acc: 55.8% | Mag MAE: 0.3466 | LR: 0.000045
  Early stopping at epoch 25 (best val loss: 0.4485)
  Saved: ./backtest_results/training_curve_fold_87.png

Validating...
  Val Loss: 0.4485 (Dir: 0.4442, Mag: 0.0860)
  Rank Accuracy: 59.8%
  Mag MAE: 0.3433
  Checkpoint saved (87 folds complete)

============================================================
FOLD 88/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 17 (best val loss: 0.4447)
  Saved: ./backtest_results/training_curve_fold_88.png

Validating...
  Val Loss: 0.4447 (Dir: 0.4404, Mag: 0.0857)
  Rank Accuracy: 59.1%
  Mag MAE: 0.3408
  Checkpoint saved (88 folds complete)

============================================================
FOLD 89/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Epoch 20/100 | Loss: 0.4554 (Dir: 0.4511, Mag: 0.0861) | Rank Acc: 57.5% | Mag MAE: 0.3437 | LR: 0.000045
  Early stopping at epoch 23 (best val loss: 0.4719)
  Saved: ./backtest_results/training_curve_fold_89.png

Validating...
  Val Loss: 0.4719 (Dir: 0.4677, Mag: 0.0830)
  Rank Accuracy: 55.1%
  Mag MAE: 0.3358
  Checkpoint saved (89 folds complete)

============================================================
FOLD 90/90
============================================================
Training snapshots: 136
Validation snapshots: 36

Training...
  Early stopping at epoch 19 (best val loss: 0.4574)
  Saved: ./backtest_results/training_curve_fold_90.png

Validating...
  Val Loss: 0.4574 (Dir: 0.4530, Mag: 0.0870)
  Rank Accuracy: 57.4%
  Mag MAE: 0.3485
  Checkpoint saved (90 folds complete)

============================================================
BACKTEST SUMMARY (v1.5 Pairwise Ranking)
============================================================
Average Val Loss: 0.4615 ± 0.0157
Best Fold: 76 (Loss: 0.4315)
Average Rank Accuracy: 57.5%
Average Mag MAE: 0.3517

Saved backtest summary: ./backtest_results/backtest_summary.png

MC Dropout Inference (10 stochastic passes)...
  Direction score mean:  -0.0751
  Direction score std:   0.1500
  Magnitude mean:        0.7150
  Magnitude uncertainty: 0.0555
  Confidence mean:       0.8714
  Confidence min/max:    0.7496 / 0.9559
  Rank stability:        0.7350

Generating attention heatmap...
  Saved attention heatmap: ./backtest_results/attention_heatmap_fold_90.png

Backtest complete! Results saved to: ./backtest_results
